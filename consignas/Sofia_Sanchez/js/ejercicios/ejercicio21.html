<!DOCTYPE html>
<html class="no-js" lang="es">

<head>
    <meta charset="utf-8" />
    <title></title>
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="../../../../assets/bootstrap/css/bootstrap.min.css" />
    <script src="ejercicio21_data.js"></script>
    <style>
        body {
            background-image: url(../img/vector-illustration-hands-holding-argentina-flags-on-white-background.jpg);
            
        }

        h1 {
            margin-top: 0, 5rem;
            text-align: center;
        }

        h2 {
            margin-top: 0.5rem;
            text-align: center;
        }

        .container {
            margin-top: 0.5rem;

        }

        button {
            margin-top: 0.5rem;
            margin-left: 0.5rem;
        }

        .table {
            margin-top: 0.5rem;
            font-size: 1.5rem;
            font-family: Georgia, 'Times New Roman', Times, serif;
        }

        #total_clientes {
                font-family: Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;
        }

        
    </style>
</head>


<body>
    <h1>BIENVENIDO!</h1>
    <h2>Formulario de inscripcion:</h2>
    <form class="container">
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="name">Nombre</label>
                <input type="text" class="form-control" id="name">
            </div>
            <div class="form-group col-md-6">
                <label for="lastname">Apellido</label>
                <input type="text" class="form-control" id="lastname">
            </div>
        </div>
        <div class="form-group">
            <label for="provincia">Provincia</label>
            <select class="form-control" id="provincia" onChange="cargarDepartamentos()">
            </select>
        </div>
        <div class="form-group">
            <label for="departamento">Departamento</label>
            <select class="form-control" id="departamento" >
            </select>
        </div>
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="localidad">Localidad</label>
                <input type="text" class="form-control" id="localidad">
            </div>
            <div class="form-group col-md-4">
                <label for="edad">Edad</label>
                <input type="number" id="edad" class="form-control">
            </div>
        </div>
    </form>

    <div class="container">

        <button class="btn btn-success" onClick="agregarCliente()">Agregrar</button>
        <button class="btn btn-primary" onClick="ordenarClientesporProvincia()">Ordenar por prov</button>
        <button class="btn btn-dark" onClick="ordenarClientesporEdad()">Edad + a -</button>
        <table class="table" id="tabla-clientes">
            <thead>
                <tr>
                    <th scope="col">Nombre</th>
                    <th scope="col">Apellido</th>
                    <th scope="col">Provincia</th>
                    <th scope="col">Departamento</th>
                    <th scope="col">Localidad</th>
                    <th scope="col">Edad</th>
                </tr>
            </thead>
            <tbody id="tabla_clientes">
            </tbody>
            <tfoot>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td id="total_clientes"> Nro de clientes</td>
                    <td id="total_clientes"></td>
                </tr>
            </tfoot>
        </table>
    </div>
    <script>
        /*
                1) Obtener lista de departamentos de la api de Argentina en formato json():
                https://infra.datos.gob.ar/catalog/modernizacion/dataset/7/distribution/7.3/download/departamentos.json
                // se puede  descargar y pegar directamente. 
                 
                2) Agregar al formulario un select de departamentos que solo muestr una lista de departamentos 
                   que corresponda a la provincia  previamente seleccionada.
                3)la columna departamento se debe agregar a la tabla que muestra los clientes
                4) Se debe agregar al array de clientes el nuevo elemento con su nombre y id.
                Tiempo estimado de ejercicio en grupo 1.30hs.
     */
        var datos_provincias = {
            "provincias": [{
                    "nombre_completo": "Provincia de Misiones",
                    "fuente": "IGN",
                    "iso_id": "AR-N",
                    "nombre": "Misiones",
                    "id": "54",
                    "categoria": "Provincia",
                    "iso_nombre": "Misiones",
                    "centroide": {
                        "lat": -26.8753965086829,
                        "lon": -54.6516966230371
                    }
                },
                {
                    "nombre_completo": "Provincia de San Luis",
                    "fuente": "IGN",
                    "iso_id": "AR-D",
                    "nombre": "San Luis",
                    "id": "74",
                    "categoria": "Provincia",
                    "iso_nombre": "San Luis",
                    "centroide": {
                        "lat": -33.7577257449137,
                        "lon": -66.0281298195836
                    }
                },
                {
                    "nombre_completo": "Provincia de San Juan",
                    "fuente": "IGN",
                    "iso_id": "AR-J",
                    "nombre": "San Juan",
                    "id": "70",
                    "categoria": "Provincia",
                    "iso_nombre": "San Juan",
                    "centroide": {
                        "lat": -30.8653679979618,
                        "lon": -68.8894908486844
                    }
                },
                {
                    "nombre_completo": "Provincia de Entre Ríos",
                    "fuente": "IGN",
                    "iso_id": "AR-E",
                    "nombre": "Entre Ríos",
                    "id": "30",
                    "categoria": "Provincia",
                    "iso_nombre": "Entre Ríos",
                    "centroide": {
                        "lat": -32.0588735436448,
                        "lon": -59.2014475514635
                    }
                },
                {
                    "nombre_completo": "Provincia de Santa Cruz",
                    "fuente": "IGN",
                    "iso_id": "AR-Z",
                    "nombre": "Santa Cruz",
                    "id": "78",
                    "categoria": "Provincia",
                    "iso_nombre": "Santa Cruz",
                    "centroide": {
                        "lat": -48.8154851827063,
                        "lon": -69.9557621671973
                    }
                },
                {
                    "nombre_completo": "Provincia de Río Negro",
                    "fuente": "IGN",
                    "iso_id": "AR-R",
                    "nombre": "Río Negro",
                    "id": "62",
                    "categoria": "Provincia",
                    "iso_nombre": "Río Negro",
                    "centroide": {
                        "lat": -40.4057957178801,
                        "lon": -67.229329893694
                    }
                },
                {
                    "nombre_completo": "Provincia del Chubut",
                    "fuente": "IGN",
                    "iso_id": "AR-U",
                    "nombre": "Chubut",
                    "id": "26",
                    "categoria": "Provincia",
                    "iso_nombre": "Chubut",
                    "centroide": {
                        "lat": -43.7886233529878,
                        "lon": -68.5267593943345
                    }
                },
                {
                    "nombre_completo": "Provincia de Córdoba",
                    "fuente": "IGN",
                    "iso_id": "AR-X",
                    "nombre": "Córdoba",
                    "id": "14",
                    "categoria": "Provincia",
                    "iso_nombre": "Córdoba",
                    "centroide": {
                        "lat": -32.142932663607,
                        "lon": -63.8017532741662
                    }
                },
                {
                    "nombre_completo": "Provincia de Mendoza",
                    "fuente": "IGN",
                    "iso_id": "AR-M",
                    "nombre": "Mendoza",
                    "id": "50",
                    "categoria": "Provincia",
                    "iso_nombre": "Mendoza",
                    "centroide": {
                        "lat": -34.6298873058957,
                        "lon": -68.5831228183798
                    }
                },
                {
                    "nombre_completo": "Provincia de La Rioja",
                    "fuente": "IGN",
                    "iso_id": "AR-F",
                    "nombre": "La Rioja",
                    "id": "46",
                    "categoria": "Provincia",
                    "iso_nombre": "La Rioja",
                    "centroide": {
                        "lat": -29.685776298315,
                        "lon": -67.1817359694432
                    }
                },
                {
                    "nombre_completo": "Provincia de Catamarca",
                    "fuente": "IGN",
                    "iso_id": "AR-K",
                    "nombre": "Catamarca",
                    "id": "10",
                    "categoria": "Provincia",
                    "iso_nombre": "Catamarca",
                    "centroide": {
                        "lat": -27.3358332810217,
                        "lon": -66.9476824299928
                    }
                },
                {
                    "nombre_completo": "Provincia de La Pampa",
                    "fuente": "IGN",
                    "iso_id": "AR-L",
                    "nombre": "La Pampa",
                    "id": "42",
                    "categoria": "Provincia",
                    "iso_nombre": "La Pampa",
                    "centroide": {
                        "lat": -37.1315537735949,
                        "lon": -65.4466546606951
                    }
                },
                {
                    "nombre_completo": "Provincia de Santiago del Estero",
                    "fuente": "IGN",
                    "iso_id": "AR-G",
                    "nombre": "Santiago del Estero",
                    "id": "86",
                    "categoria": "Provincia",
                    "iso_nombre": "Santiago del Estero",
                    "centroide": {
                        "lat": -27.7824116550944,
                        "lon": -63.2523866568588
                    }
                },
                {
                    "nombre_completo": "Provincia de Corrientes",
                    "fuente": "IGN",
                    "iso_id": "AR-W",
                    "nombre": "Corrientes",
                    "id": "18",
                    "categoria": "Provincia",
                    "iso_nombre": "Corrientes",
                    "centroide": {
                        "lat": -28.7743047046407,
                        "lon": -57.8012191977913
                    }
                },
                {
                    "nombre_completo": "Provincia de Santa Fe",
                    "fuente": "IGN",
                    "iso_id": "AR-S",
                    "nombre": "Santa Fe",
                    "id": "82",
                    "categoria": "Provincia",
                    "iso_nombre": "Santa Fe",
                    "centroide": {
                        "lat": -30.7069271588117,
                        "lon": -60.9498369430241
                    }
                },
                {
                    "nombre_completo": "Provincia de Tucumán",
                    "fuente": "IGN",
                    "iso_id": "AR-T",
                    "nombre": "Tucumán",
                    "id": "90",
                    "categoria": "Provincia",
                    "iso_nombre": "Tucumán",
                    "centroide": {
                        "lat": -26.9478001830786,
                        "lon": -65.3647579441481
                    }
                },
                {
                    "nombre_completo": "Provincia del Neuquén",
                    "fuente": "IGN",
                    "iso_id": "AR-Q",
                    "nombre": "Neuquén",
                    "id": "58",
                    "categoria": "Provincia",
                    "iso_nombre": "Neuquén",
                    "centroide": {
                        "lat": -38.6417575824599,
                        "lon": -70.1185705180601
                    }
                },
                {
                    "nombre_completo": "Provincia de Salta",
                    "fuente": "IGN",
                    "iso_id": "AR-A",
                    "nombre": "Salta",
                    "id": "66",
                    "categoria": "Provincia",
                    "iso_nombre": "Salta",
                    "centroide": {
                        "lat": -24.2991344492002,
                        "lon": -64.8144629600627
                    }
                },
                {
                    "nombre_completo": "Provincia del Chaco",
                    "fuente": "IGN",
                    "iso_id": "AR-H",
                    "nombre": "Chaco",
                    "id": "22",
                    "categoria": "Provincia",
                    "iso_nombre": "Chaco",
                    "centroide": {
                        "lat": -26.3864309061226,
                        "lon": -60.7658307438603
                    }
                },
                {
                    "nombre_completo": "Provincia de Formosa",
                    "fuente": "IGN",
                    "iso_id": "AR-P",
                    "nombre": "Formosa",
                    "id": "34",
                    "categoria": "Provincia",
                    "iso_nombre": "Formosa",
                    "centroide": {
                        "lat": -24.894972594871,
                        "lon": -59.9324405800872
                    }
                },
                {
                    "nombre_completo": "Provincia de Jujuy",
                    "fuente": "IGN",
                    "iso_id": "AR-Y",
                    "nombre": "Jujuy",
                    "id": "38",
                    "categoria": "Provincia",
                    "iso_nombre": "Jujuy",
                    "centroide": {
                        "lat": -23.3200784211351,
                        "lon": -65.7642522180337
                    }
                },
                {
                    "nombre_completo": "Ciudad Autónoma de Buenos Aires",
                    "fuente": "IGN",
                    "iso_id": "AR-C",
                    "nombre": "Ciudad Autónoma de Buenos Aires",
                    "id": "02",
                    "categoria": "Ciudad Autónoma",
                    "iso_nombre": "Ciudad Autónoma de Buenos Aires",
                    "centroide": {
                        "lat": -34.6144934119689,
                        "lon": -58.4458563545429
                    }
                },
                {
                    "nombre_completo": "Provincia de Buenos Aires",
                    "fuente": "IGN",
                    "iso_id": "AR-B",
                    "nombre": "Buenos Aires",
                    "id": "06",
                    "categoria": "Provincia",
                    "iso_nombre": "Buenos Aires",
                    "centroide": {
                        "lat": -36.6769415180527,
                        "lon": -60.5588319815719
                    }
                },
                {
                    "nombre_completo": "Provincia de Tierra del Fuego, Antártida e Islas del Atlántico Sur",
                    "fuente": "IGN",
                    "iso_id": "AR-V",
                    "nombre": "Tierra del Fuego, Antártida e Islas del Atlántico Sur",
                    "id": "94",
                    "categoria": "Provincia",
                    "iso_nombre": "Tierra del Fuego",
                    "centroide": {
                        "lat": -82.52151781221,
                        "lon": -50.7427486049785
                    }
                }
            ],
            "total": 24,
            "cantidad": 24,
            "parametros": {},
            "inicio": 0
        }
        var nuevos_clientes = []
        //llamo a la funcion para cargar las provincias al select
        cargarProvincias()
        

        /*Esta funcion carga las provincias en el elemento provincia(select) 
        desde la variable que las contiene (datos_provincias)*/
        function cargarProvincias() {
            let select = document.getElementById('provincia'); //llamo al select por su id

            datos_provincias.provincias.forEach(
                provincia => { //itero sobre cada provincia de la variable datos_provincias

                    let opt = document.createElement('option'); //dentro de una variable creo un elemento "option"
                    opt.appendChild(document.createTextNode(provincia
                        .nombre
                    )); //al elemento "option" le creo un "hijo" de tipo texto donde llamo a los atributos que estan dentro de provincias
                    opt.value = provincia
                        .id; //al elemento option le agrego un value para obtner su id a partir del atributo provincia
                    select.appendChild(opt); //llamo al elemento select le agrego un "hijo" y le agrego el option
                });
            }
                

        function agregarCliente() {
            let nombre = document.getElementById("name").value;
            let apellido = document.getElementById("lastname").value;
            let provincia = document.getElementById("provincia")
            let selected_pro = provincia.options[provincia.selectedIndex].text
            let departamento = document.getElementById("departamento")
            let selected = departamento.options[departamento.selectedIndex].text
            let localidad = document.getElementById("localidad").value;
            let edad = document.getElementById("edad").value;
            //creo objeto que representa un cliente
            let client = {
                "nombre": nombre,
                "apellido": apellido,
                "provincia": {
                    "id": provincia.value,
                    "nombre": selected_pro
                },
                "departamento": {
                    "id": departamento.value,
                    "nombre" : selected
                },
                "localidad": localidad,
                "edad": edad
            }
            nuevos_clientes.push(client)
            poblarTabla()


        }

        function poblarTabla() {
            let tabla = ""
            nuevos_clientes.forEach(cliente => {
                tabla = tabla + "<tr><td>" + cliente.nombre + "</td><td>" + cliente.apellido + "</td><td>" +
                    cliente.provincia.nombre + "</td><td>" + cliente.departamento.nombre + "</td><td>" + cliente.localidad + "</td><td>" + cliente.edad +  
                    "</td></tr>"
            })
            let tabla_clientes = document.getElementById("tabla_clientes")
            tabla_clientes.innerHTML = tabla
            document.getElementById("total_clientes").innerHTML = nuevos_clientes.length

        }

        function ordenarClientesporEdad() {
            nuevos_clientes.sort(function (a, b) {
                return a.edad - b.edad
            })
            poblarTabla()
        }

        function ordenarClientesporProvincia() {
            nuevos_clientes.sort(function (a, b) {
                if (a.provincia.nombre > b.provincia.nombre) {
                    return 1;
                }
                if (a.provincia.nombre < b.provincia.nombre) {
                    return -1;
                }
                return 0;
            })
            poblarTabla()
        }

        function cargarDepartamentos() {

            let select = document.getElementById('departamento'); //llamo al select por su id
            select.innerHTML = ""
            let provincia_elegida = document.getElementById("provincia").value
            departamentos.departamentos.forEach(departamento => {
                if (provincia_elegida == departamento.provincia.id) {
                    let opt = document.createElement('option');
                    opt.appendChild(document.createTextNode(departamento.nombre));
                    opt.value = provincia.id;
                    select.appendChild(opt);

                }


            });
        }
    </script>

    </script>